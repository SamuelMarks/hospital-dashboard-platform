<!-- Header -->
<div mat-dialog-title class="flex items-center justify-between border-b pb-2">
  <div class="flex flex-col">
    <span class="text-lg font-medium">Edit Widget</span>
    <span class="text-xs text-gray-500 font-mono flex items-center gap-2">
      {{ widget.title }}
      <span class="bg-blue-50 text-blue-700 px-1 rounded border border-blue-100">{{
        widget.type
      }}</span>
    </span>
  </div>
  <button mat-icon-button mat-dialog-close>
    <mat-icon>close</mat-icon>
  </button>
</div>

<!-- Content (Editor Implementation) -->
<mat-dialog-content>
  @switch (widget.type) {
    @case ('SQL') {
      <app-sql-builder
        [dashboardId]="data.dashboardId"
        [widgetId]="widget.id"
        [initialSql]="initialSql()"
        (sqlChange)="handleEditorSave()"
        class="h-full block"
      ></app-sql-builder>
    }
    @case ('HTTP') {
      <app-http-config
        [dashboardId]="data.dashboardId"
        [widgetId]="widget.id"
        [initialConfig]="widget.config"
        (configChange)="handleEditorSave()"
        class="h-full block"
      ></app-http-config>
    }
  }
</mat-dialog-content>

<!-- Visualization Mapping Settings -->
<!-- Only show if viz type supports mapping -->
@if (supportsMapping()) {
  <div class="viz-settings-panel">
    <div class="text-xs font-bold uppercase text-gray-500 mb-2">
      Visualization Settings ({{ widget.visualization }})
    </div>

    <div class="settings-grid">
      <!-- X-Axis / Label Selector -->
      <mat-form-field appearance="outline" subscriptSizing="dynamic">
        <mat-label>{{ isPie() ? 'Label Column' : 'X-Axis / Category' }}</mat-label>
        <mat-select [(ngModel)]="xKey" [disabled]="columns().length === 0">
          <mat-option [value]="null">-- Auto --</mat-option>
          @for (col of columns(); track col) {
            <mat-option [value]="col">{{ col }}</mat-option>
          }
        </mat-select>
      </mat-form-field>

      <!-- Y-Axis / Value Selector -->
      <mat-form-field appearance="outline" subscriptSizing="dynamic">
        <mat-label>{{ isPie() ? 'Size Column' : 'Y-Axis / Value' }}</mat-label>
        <mat-select [(ngModel)]="yKey" [disabled]="columns().length === 0">
          <mat-option [value]="null">-- Auto --</mat-option>
          @for (col of columns(); track col) {
            <mat-option [value]="col">{{ col }}</mat-option>
          }
        </mat-select>
      </mat-form-field>

      <button mat-flat-button color="primary" (click)="saveSettings()">Update Viz</button>
    </div>

    @if (columns().length === 0) {
      <div class="text-xs text-amber-700 mt-2">
        Run the query in the editor above to populate available columns.
      </div>
    }
  </div>
}
